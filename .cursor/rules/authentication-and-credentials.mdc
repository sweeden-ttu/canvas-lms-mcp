---
description: Tokens are only allowed for Canvas API; all other service providers must use SSH public/private key pairs; git operations must use SSH keys, not tokens or credential helpers.
alwaysApply: true
---

# Authentication and Credentials (Global Rule)

## Scope

This rule applies to **all** authentication methods, credentials, and service provider integrations in this project. It governs how tokens, SSH keys, and other authentication mechanisms are used.

## Token Usage Policy

### Tokens Only for Canvas

**API tokens are ONLY allowed for Canvas LMS API authentication.**

- **Canvas API Token**: Required for accessing Canvas LMS REST API
- **Storage**: Canvas tokens must be stored in `.env` file (never committed)
- **Usage**: Canvas tokens are used exclusively for Canvas API calls
- **Example**: `CANVAS_API_TOKEN` in `.env` file

### No Tokens for Other Services

**API tokens are PROHIBITED for all other service providers**, including but not limited to:

- **GitHub**: Must use SSH keys, not personal access tokens
- **GitLab**: Must use SSH keys, not personal access tokens
- **Bitbucket**: Must use SSH keys, not personal access tokens
- **Other Git Hosting**: Must use SSH keys, not tokens
- **Cloud Providers**: Must use SSH keys or service-specific key pairs
- **CI/CD Platforms**: Must use SSH keys or OAuth, not tokens

**Exception**: Canvas API is the ONLY service allowed to use tokens.

## SSH Key Requirements

### SSH Keys for All Non-Canvas Services

**All service providers (except Canvas) must use SSH public/private key pairs:**

1. **Generate SSH keys**: Use `ssh-keygen` to create key pairs
2. **Add public key to service**: Upload public key to service provider (GitHub, GitLab, etc.)
3. **Use SSH URLs**: Configure git remotes to use SSH URLs (`git@host:repo.git`)
4. **Protect private keys**: Ensure private keys have correct permissions (600)

### SSH Key Best Practices

- **Key location**: Store keys in `~/.ssh/` directory
- **Key permissions**: 
  - Private keys: `600` (rw-------)
  - Public keys: `644` (rw-r--r--)
  - `.ssh` directory: `700` (drwx------)
- **Key naming**: Use descriptive names (e.g., `id_ed25519_github`, `id_rsa_gitlab`)
- **Key rotation**: Rotate keys periodically for security
- **Multiple keys**: Use different keys for different services when possible

## Git Configuration Requirements

### SSH URLs Only

**All git remotes must use SSH URLs, not HTTPS:**

```bash
# CORRECT - SSH URL
git remote set-url origin git@github.com:user/repo.git

# INCORRECT - HTTPS URL (requires token)
git remote set-url origin https://github.com/user/repo.git
```

### No Credential Helpers

**Do NOT configure git credential helpers that use tokens:**

- **Prohibited**: `git config credential.helper store`
- **Prohibited**: `git config credential.helper cache`
- **Prohibited**: `git config credential.https://github.com.helper`
- **Prohibited**: Any credential helper that stores or caches tokens

**Git operations must authenticate using SSH keys only.**

### Git Operations Using SSH

**All git operations must work using only the `git` command with SSH:**

- `git push` → Uses SSH key authentication
- `git pull` → Uses SSH key authentication
- `git fetch` → Uses SSH key authentication
- `git clone` → Uses SSH URL and SSH key authentication

**No GitHub CLI (`gh`), GitLab CLI (`glab`), or other tools required for basic git operations.**

## Verification Checklist

Before committing or pushing code, verify:

- [ ] Git remote URLs use SSH format (`git@host:repo.git`)
- [ ] No credential helpers configured (`git config --list | grep credential`)
- [ ] SSH keys exist and have correct permissions
- [ ] SSH connection to git host works (`ssh -T git@host`)
- [ ] No tokens in `.env` except `CANVAS_API_TOKEN`
- [ ] No tokens in git configuration
- [ ] Git operations work using only `git` command

## Configuration Examples

### Correct Git Remote Configuration

```bash
# Check current remote
git remote -v

# Should show SSH URLs:
# origin  git@github.com:user/repo.git (fetch)
# origin  git@github.com:user/repo.git (push)

# If HTTPS, convert to SSH:
git remote set-url origin git@github.com:user/repo.git
```

### Correct .env File

```bash
# .env file - ONLY Canvas token allowed
CANVAS_API_TOKEN=your_canvas_token_here
CANVAS_BASE_URL=https://texastech.instructure.com

# NO other tokens allowed:
# GITHUB_TOKEN=...  # PROHIBITED
# GITLAB_TOKEN=...  # PROHIBITED
# BITBUCKET_TOKEN=...  # PROHIBITED
```

### SSH Key Setup

```bash
# Generate SSH key (if needed)
ssh-keygen -t ed25519 -C "your_email@example.com" -f ~/.ssh/id_ed25519_github

# Set correct permissions
chmod 600 ~/.ssh/id_ed25519_github
chmod 644 ~/.ssh/id_ed25519_github.pub
chmod 700 ~/.ssh

# Add to SSH config (optional, for multiple keys)
cat >> ~/.ssh/config << EOF
Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/id_ed25519_github
EOF

# Test SSH connection
ssh -T git@github.com
```

## Prohibited Configurations

### Do NOT Use

1. **HTTPS git URLs**: `https://github.com/user/repo.git`
2. **Personal Access Tokens**: For GitHub, GitLab, or any non-Canvas service
3. **Credential Helpers**: `credential.helper`, `credential.https://...`
4. **Token Storage**: In `.env`, config files, or environment variables (except Canvas)
5. **GitHub CLI Auth**: Using `gh auth login` with tokens (use SSH instead)
6. **GitLab CLI Auth**: Using `glab auth login` with tokens (use SSH instead)

### Common Mistakes to Avoid

- **Mistake**: Using HTTPS URLs and entering token as password
- **Solution**: Convert to SSH URL and use SSH key

- **Mistake**: Storing GitHub token in `.env` for CI/CD
- **Solution**: Use SSH deploy keys or SSH keys in CI/CD

- **Mistake**: Using `gh auth login` with token
- **Solution**: Use `gh auth login --git-protocol ssh` or configure SSH manually

## Canvas Token Exception

### Canvas API Token Usage

**Canvas is the ONLY exception** to the no-tokens rule:

- **Required**: Canvas API requires token-based authentication
- **Storage**: Store in `.env` file (gitignored)
- **Usage**: Only for Canvas API calls (`CANVAS_API_TOKEN`)
- **Security**: Never commit `.env` file, never expose token in code

### Canvas Token Best Practices

- Store in `.env` file (not committed)
- Use `.env.example` as template (without real token)
- Rotate tokens periodically
- Use least-privilege token scopes
- Never log or expose tokens

## Integration with Other Rules

This rule works in conjunction with:

- **File management rule**: Git operations must use SSH
- **No synthetic data rule**: Canvas API calls use real tokens for real data
- **Data management rule**: Canvas data synchronization uses Canvas tokens

## Enforcement

This rule is project-wide and applies to:

- All git operations and repository access
- All service provider integrations
- All credential storage and management
- All CI/CD configurations
- All AI agents and coding assistants
- All contributors (human and AI)

## Troubleshooting

### Git Push Fails with Authentication Error

1. **Check remote URL**: `git remote -v` should show SSH URL
2. **Check SSH connection**: `ssh -T git@github.com` should work
3. **Check SSH keys**: `ls -la ~/.ssh/id_*` should show keys with correct permissions
4. **Remove credential helpers**: `git config --global --unset credential.helper`

### Token Found in Configuration

1. **Remove from .env**: Delete any non-Canvas tokens
2. **Remove from git config**: `git config --global --unset-all credential.*`
3. **Convert HTTPS to SSH**: `git remote set-url origin git@host:repo.git`
4. **Verify**: `git config --list | grep -i credential` should show nothing

### SSH Key Not Working

1. **Check permissions**: `stat -c "%a %n" ~/.ssh/id_*`
2. **Test connection**: `ssh -T git@host`
3. **Check SSH config**: `cat ~/.ssh/config`
4. **Add key to agent**: `ssh-add ~/.ssh/id_ed25519`

When in doubt, **use SSH keys for everything except Canvas**, and **verify git operations work with only the `git` command**.